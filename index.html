<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Organizador Estudiantil</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .menu-container {
        position: relative;
        display: inline-block;
        margin-bottom: 15px;
      }

      .menu-button {
        background-color: #da1212;
        color: white;
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
      }

      .menu-list {
        display: none;
        position: absolute;
        background-color: white;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        min-width: 150px;
        border-radius: 5px;
        overflow: hidden;
        z-index: 1000;
      }

      .menu-list a {
        display: block;
        padding: 10px;
        text-decoration: none;
        color: black;
        border-bottom: 1px solid #ddd;
      }

      .menu-list a:hover {
        background-color: #f1f1f1;
      }

      .show {
        display: block;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1 style="font-family: sans-serif">Organizador Estudiantil</h1>

      <!-- Menú desplegable -->
      <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">☰ Menú</button>
        <div class="menu-list" id="menuList">
          <a href="index.html">Inicio</a>
          <a href="tareasExternas.html">Tareas Externas</a>
          <a href="notas.html">Notas Rápidas</a>
        </div>
      </div>

      <!-- Sección de Tareas -->
      <div class="section">
        <h2>Tareas Externas</h2>
        <input type="text" id="taskName" placeholder="Nombre de la tarea..." />
        <input
          type="text"
          id="subTasks"
          placeholder="Subtareas (separadas por comas)..."
        />
        <input type="number" id="taskHours" placeholder="Horas invertidas..." />
        <button onclick="addTask()">Agregar Tarea</button>
        <button onclick="limpiarTareas()">Borrar Las Tareas Guardadas</button>
        <div id="tasksList"></div>
      </div>

      <!-- Sección de Notas -->
      <div class="section">
        <h2>Notas Rápidas</h2>
        <textarea id="noteInput" placeholder="Escribe una nota..."></textarea>
        <button onclick="addNote()">Agregar Nota</button>
        <div id="notesList"></div>
      </div>

      <!-- Sección de Crear Clase -->
      <div class="section">
        <h2>Crear Clase</h2>
        <input
          type="text"
          id="className"
          placeholder="Nombre de la materia..."
        />
        <input
          type="text"
          id="classTeacher"
          placeholder="Nombre del docente..."
        />
        <button onclick="createClass()">Crear Clase</button>
        <button onclick="limpiarClases()">Borrar Clases Anteriores</button>
      </div>

      <h2>Clases Creadas</h2>
      <div id="clases-container"></div>

      <!-- Sección Pomodoro -->
      <div class="section">
        <h2>Temporizador Pomodoro</h2>
        <label
          >Tiempo de trabajo (min):
          <input type="number" id="workTime" value="25"
        /></label>
        <label
          >Tiempo de descanso (min):
          <input type="number" id="breakTime" value="5"
        /></label>
        <p id="timerDisplay">25:00</p>
        <button onclick="startPomodoro()">Iniciar</button>
        <button onclick="pausePomodoro()">Pausar</button>
        <button onclick="resetPomodoro()">Reiniciar</button>
      </div>

      <!-- Reproductor de Spotify -->
      <div class="section">
        <h2>Reproductor de Música</h2>
        <div class="spotify-player">
          <iframe
            id="spotify-embed"
            src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M"
            width="100%"
            height="380"
            frameborder="0"
            allowtransparency="true"
            allow="encrypted-media"
          >
          </iframe>
        </div>
      </div>

      <!-- Sección de Calendario -->
      <div class="section">
        <h2>Calendario</h2>
        <iframe
          src="https://calendar.google.com/calendar/embed?src=es-419%23week%40group.v.calendar.google.com&ctz=America%2FMexico_City"
          style="border: 0"
          width="100%"
          height="600"
          frameborder="0"
          scrolling="no"
        >
        </iframe>
      </div>
    </div>

    <script>
      let pomodoroTimer;
      let isRunning = false;
      let timeLeft;
      let isWorkSession = true;

      function startPomodoro() {
        if (isRunning) return;

        let workMinutes =
          parseInt(document.getElementById("workTime").value) || 25;
        let breakMinutes =
          parseInt(document.getElementById("breakTime").value) || 5;

        if (!timeLeft) {
          timeLeft = isWorkSession ? workMinutes * 60 : breakMinutes * 60;
        }

        isRunning = true;
        pomodoroTimer = setInterval(() => {
          let minutes = Math.floor(timeLeft / 60);
          let seconds = timeLeft % 60;
          document.getElementById("timerDisplay").textContent = `${minutes}:${
            seconds < 10 ? "0" : ""
          }${seconds}`;

          if (timeLeft > 0) {
            timeLeft--;
          } else {
            clearInterval(pomodoroTimer);
            isRunning = false;
            isWorkSession = !isWorkSession;
            alert(
              isWorkSession ? "¡Hora de trabajar!" : "¡Tiempo de descanso!"
            );
            timeLeft = isWorkSession ? workMinutes * 60 : breakMinutes * 60;
            startPomodoro();
          }
        }, 1000);
      }

      function pausePomodoro() {
        clearInterval(pomodoroTimer);
        isRunning = false;
      }

      function resetPomodoro() {
        clearInterval(pomodoroTimer);
        isRunning = false;
        isWorkSession = true;
        timeLeft =
          parseInt(document.getElementById("workTime").value) * 60 || 25 * 60;
        document.getElementById("timerDisplay").textContent = `${Math.floor(
          timeLeft / 60
        )}:00`;
      }

      document.addEventListener("DOMContentLoaded", function () {
        let contenedor = document.getElementById("clases-container");
        contenedor.innerHTML = "";
        let clases = JSON.parse(localStorage.getItem("clases") || "[]");
        clases.forEach(mostrarClase);
      });

      function createClass() {
        let nombreClase = document.getElementById("className").value.trim();
        let nombreDocente = document
          .getElementById("classTeacher")
          .value.trim();

        if (!nombreClase || !nombreDocente) {
          alert("Ingresa el nombre de la clase y del docente.");
          return;
        }

        let clases = JSON.parse(localStorage.getItem("clases") || "[]");

        if (clases.some((clase) => clase.nombre === nombreClase)) {
          alert("Esta clase ya existe.");
          return;
        }

        let nuevaClase = { nombre: nombreClase, docente: nombreDocente };
        clases.push(nuevaClase);
        localStorage.setItem("clases", JSON.stringify(clases));

        mostrarClase(nuevaClase);

        document.getElementById("className").value = "";
        document.getElementById("classTeacher").value = "";
      }

      function mostrarClase(clase) {
        let contenedor = document.getElementById("clases-container");

        let botonClase = document.createElement("button");
        botonClase.textContent = clase.nombre;
        botonClase.style.display = "block";
        botonClase.style.marginTop = "5px";

        botonClase.onclick = function () {
          let url = `btn1.html?nombre=${encodeURIComponent(
            clase.nombre
          )}&docente=${encodeURIComponent(clase.docente)}`;
          window.location.href = url;
        };

        contenedor.appendChild(botonClase);
      }

      function limpiarClases() {
        localStorage.removeItem("clases");
        document.getElementById("clases-container").innerHTML = "";
        alert("¡Las clases guardadas han sido eliminadas!");
      }

      <!-- Menú desplegable -->
      function toggleMenu() {
        document.getElementById("menuList").classList.toggle("show");
      }

      window.onclick = function (event) {
        if (!event.target.matches(".menu-button")) {
          let dropdowns = document.getElementsByClassName("menu-list");
          for (let i = 0; i < dropdowns.length; i++) {
            let openDropdown = dropdowns[i];
            if (openDropdown.classList.contains("show")) {
              openDropdown.classList.remove("show");
            }
          }
        }
      };

      function addTask() {
        let taskName = document.getElementById("taskName").value.trim();
        let subTasks = document.getElementById("subTasks").value.trim();
        let taskHours = document.getElementById("taskHours").value.trim();

        if (!taskName) {
          alert("Por favor, ingresa un nombre para la tarea.");
          return;
        }

        let newTask = { name: taskName, subTasks: subTasks, hours: taskHours };

        // Obtener tareas previas de localStorage
        let tasks = JSON.parse(localStorage.getItem("externalTasks")) || [];
        tasks.push(newTask);

        // Guardar nuevamente en localStorage
        localStorage.setItem("externalTasks", JSON.stringify(tasks));

        // Limpiar los campos después de agregar la tarea
        document.getElementById("taskName").value = "";
        document.getElementById("subTasks").value = "";
        document.getElementById("taskHours").value = "";
      }

      function displayTasks() {
        let tasks = JSON.parse(localStorage.getItem("externalTasks")) || [];
        let tasksListDiv = document.getElementById("tasksList");

        // Limpiar lista antes de actualizar
        tasksListDiv.innerHTML = "";

        // Mostrar cada tarea en la lista
        tasks.forEach((task) => {
          let taskItem = document.createElement("div");
          taskItem.innerHTML = `<strong>${task.name}</strong> - ${task.subTasks} (${task.hours} horas)`;
          tasksListDiv.appendChild(taskItem);
        });
      }

      // Mostrar tareas al cargar la página
      document.addEventListener("DOMContentLoaded", displayTasks);

      function displayTasks() {
        // Cargar tareas solo de la clave específica para la página externa
        let tasks = JSON.parse(localStorage.getItem("externalTasks")) || [];
        let tasksListDiv = document.getElementById("tasksList");
      }
      function limpiarTareas() {
        localStorage.removeItem("externalTasks");
        alert("Tareas externas eliminadas.");
      }
    </script>
  </body>
</html>
